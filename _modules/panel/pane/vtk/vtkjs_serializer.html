<!DOCTYPE html>

<html lang="en">
<head>
<!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<meta charset="utf-8"/>
<title>panel.pane.vtk.vtkjs_serializer — Panel 0.9.6 documentation</title>
<meta content="High-level dashboarding for python visualization libraries" name="description"/>
<meta content="Panel contributors" name="author"/>
<!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
<script>
    WebFont.load({
      google: {
        families: ['Source Sans Pro']
      }
    });
  </script>
<!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<link href="../../../../_static/css/main.css" rel="stylesheet"/>
<link href="../../../../_static/nbsite.css" rel="stylesheet"/>
<link href="../../../../_static/site.css" rel="stylesheet"/>
<!-- Scripts
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript">
</script>
<script src="../../../../_static/js/main.js"></script>
<!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<link href="../../../../_static/favicon.ico" rel="icon" type="image/png"/>
<!-- Canonical
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
<link href="https://panel.holoviz.org/_modules/panel/pane/vtk/vtkjs_serializer.html" rel="canonical">
</link></head>
<body class="">
<header class="navigation">
<div class="wrapper">
<a class="logo" href="../../../../index.html">
<img alt="Logo" src="../../../../_static/logo_horizontal.png"/>
</a>
<a class="navigation-menu-button" href="javascript:void(0)" id="js-mobile-menu">Menu</a>
<nav>
<ul class="navigation-menu show" id="js-navigation-menu">
<li class="nav-link doc-head"><a href="//discourse.holoviz.org">Discourse</a></li>
<li class="nav-link doc-head"><a href="//twitter.com/Panel_org">Twitter</a></li>
<li class="nav-link doc-head"><a href="//github.com/pyviz/panel">Github</a></li>
<li class="nav-link">
<div style="display:inline-block;vertical-align: middle;">
<div class="search-bar">
<form action="../../../../search.html" method="get" role="search">
<input name="q" placeholder="Search" type="search"/>
<button type="submit">
<img alt="Search Icon" src="https://raw.githubusercontent.com/thoughtbot/refills/master/source/images/search-icon-black.png"/>
</button>
</form>
</div>
</div>
</li>
</ul>
</nav>
</div>
</header>
<div class="second-nav">
<nav>
<ul class="navigation-menu show">
<li class="nav-link doc-head"><a href="../../../../getting_started/index.html">Getting started</a></li>
<li class="nav-link doc-head"><a href="../../../../user_guide/index.html">User Guide</a></li>
<li class="nav-link doc-head"><a href="../../../../gallery/index.html">Gallery</a></li>
<li class="nav-link doc-head"><a href="../../../../reference/index.html">Reference Gallery</a></li>
<li class="nav-link doc-head"><a href="../../../../developer_guide/index.html">Developer Guide</a></li>
<li class="nav-link doc-head"><a href="../../../../releases.html">Releases</a></li>
<li class="nav-link doc-head"><a href="../../../../api/index.html">API</a></li>
<li class="nav-link doc-head"><a href="../../../../FAQ.html">FAQ</a></li>
<li class="nav-link doc-head"><a href="../../../../about.html">About</a></li>
</ul>
</nav>
</div>
<!-- MAIN BODY OF DOCS –––––––––––––––––– -->
<div class="docs section">
<div id="hacketyhackhack"> <!-- style="width:20%;margin-right: 100px;"> --> <!--style="display: none;"> style="display:none;"> -->
<div class="toc" style="width:15%; margin-right:20px;">
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../user_guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">Reference Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developer_guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/index.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Comparisons.html">Comparisons</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../Roadmap.html">Road Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference external" href="http://github.com/pyviz/panel">Github source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../about.html">About</a></li>
</ul>
</div>
</div>
<div class="content"> <!-- style="max-width:80%;margin-left:auto;margin-right: auto;">-->
<h1>Source code for panel.pane.vtk.vtkjs_serializer</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding: utf-8</span>
<span class="sd">"""</span>
<span class="sd">Serializer of vtk render windows</span>
<span class="sd">Adpation from :</span>
<span class="sd">https://kitware.github.io/vtk-js/examples/SceneExplorer.html</span>
<span class="sd">https://raw.githubusercontent.com/Kitware/vtk-js/master/Utilities/ParaView/export-scene-macro.py</span>
<span class="sd">Licence :</span>
<span class="sd">https://github.com/Kitware/vtk-js/blob/master/LICENSE</span>
<span class="sd">"""</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">hashlib</span><span class="o">,</span> <span class="nn">zipfile</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
    <span class="kn">import</span> <span class="nn">imp</span>
    <span class="n">vtk</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="s1">'vtk'</span><span class="p">,</span> <span class="o">*</span><span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="s1">'vtk'</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">vtk</span>

<span class="kn">from</span> <span class="nn">.enums</span> <span class="kn">import</span> <span class="n">SCALAR_MODE</span><span class="p">,</span> <span class="n">ACCESS_MODE</span>

<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">):</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="nb">memoryview</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">buffer</span> <span class="o">=</span> <span class="n">buffer</span>

<span class="n">arrayTypesMapping</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">' '</span><span class="p">,</span> <span class="c1"># VTK_VOID            0</span>
  <span class="s1">' '</span><span class="p">,</span> <span class="c1"># VTK_BIT             1</span>
  <span class="s1">'b'</span><span class="p">,</span> <span class="c1"># VTK_CHAR            2</span>
  <span class="s1">'B'</span><span class="p">,</span> <span class="c1"># VTK_UNSIGNED_CHAR   3</span>
  <span class="s1">'h'</span><span class="p">,</span> <span class="c1"># VTK_SHORT           4</span>
  <span class="s1">'H'</span><span class="p">,</span> <span class="c1"># VTK_UNSIGNED_SHORT  5</span>
  <span class="s1">'i'</span><span class="p">,</span> <span class="c1"># VTK_INT             6</span>
  <span class="s1">'I'</span><span class="p">,</span> <span class="c1"># VTK_UNSIGNED_INT    7</span>
  <span class="s1">'l'</span><span class="p">,</span> <span class="c1"># VTK_LONG            8</span>
  <span class="s1">'L'</span><span class="p">,</span> <span class="c1"># VTK_UNSIGNED_LONG   9</span>
  <span class="s1">'f'</span><span class="p">,</span> <span class="c1"># VTK_FLOAT          10</span>
  <span class="s1">'d'</span><span class="p">,</span> <span class="c1"># VTK_DOUBLE         11</span>
  <span class="s1">'L'</span><span class="p">,</span> <span class="c1"># VTK_ID_TYPE        12</span>
<span class="p">]</span>

<span class="n">_js_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'b'</span><span class="p">:</span> <span class="s1">'Int8Array'</span><span class="p">,</span>
    <span class="s1">'B'</span><span class="p">:</span> <span class="s1">'Uint8Array'</span><span class="p">,</span>
    <span class="s1">'h'</span><span class="p">:</span> <span class="s1">'Int16Array'</span><span class="p">,</span>
    <span class="s1">'H'</span><span class="p">:</span> <span class="s1">'Int16Array'</span><span class="p">,</span>
    <span class="s1">'i'</span><span class="p">:</span> <span class="s1">'Int32Array'</span><span class="p">,</span>
    <span class="s1">'I'</span><span class="p">:</span> <span class="s1">'Uint32Array'</span><span class="p">,</span>
    <span class="s1">'l'</span><span class="p">:</span> <span class="s1">'Int32Array'</span><span class="p">,</span>
    <span class="s1">'L'</span><span class="p">:</span> <span class="s1">'Uint32Array'</span><span class="p">,</span>
    <span class="s1">'f'</span><span class="p">:</span> <span class="s1">'Float32Array'</span><span class="p">,</span>
    <span class="s1">'d'</span><span class="p">:</span> <span class="s1">'Float64Array'</span>
<span class="p">}</span>

<span class="n">_writer_mapping</span> <span class="o">=</span> <span class="p">{}</span>


<span class="k">def</span> <span class="nf">_get_range_info</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">component</span><span class="p">):</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">GetRange</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
    <span class="n">compRange</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">compRange</span><span class="p">[</span><span class="s1">'min'</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">compRange</span><span class="p">[</span><span class="s1">'max'</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">compRange</span><span class="p">[</span><span class="s1">'component'</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">GetComponentName</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">compRange</span>


<span class="k">def</span> <span class="nf">_get_ref</span><span class="p">(</span><span class="n">destDirectory</span><span class="p">,</span> <span class="n">md5</span><span class="p">):</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ref</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span> <span class="o">=</span> <span class="n">md5</span>
    <span class="n">ref</span><span class="p">[</span><span class="s1">'encode'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'BigEndian'</span> <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">==</span> <span class="s1">'big'</span> <span class="k">else</span> <span class="s1">'LittleEndian'</span>
    <span class="n">ref</span><span class="p">[</span><span class="s1">'basepath'</span><span class="p">]</span> <span class="o">=</span> <span class="n">destDirectory</span>
    <span class="k">return</span> <span class="n">ref</span>


<span class="k">def</span> <span class="nf">_get_object_id</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">objIds</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">objIds</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="n">objIds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">objIds</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_dump_data_array</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">array</span><span class="p">):</span>
    <span class="n">root</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">array</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">GetDataType</span><span class="p">()</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
        <span class="c1"># IdType need to be converted to Uint32</span>
        <span class="n">arraySize</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">GetNumberOfTuples</span><span class="p">()</span> <span class="o">*</span> <span class="n">array</span><span class="o">.</span><span class="n">GetNumberOfComponents</span><span class="p">()</span>
        <span class="n">newArray</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkTypeUInt32Array</span><span class="p">()</span>
        <span class="n">newArray</span><span class="o">.</span><span class="n">SetNumberOfTuples</span><span class="p">(</span><span class="n">arraySize</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arraySize</span><span class="p">):</span>
            <span class="n">newArray</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">array</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">pBuffer</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">(</span><span class="n">newArray</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pBuffer</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

    <span class="n">pMd5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">pBuffer</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="n">pPath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dataDir</span><span class="p">,</span> <span class="n">pMd5</span><span class="p">)</span>

    <span class="n">scDirs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pPath</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">pBuffer</span><span class="p">)])</span>

    <span class="n">root</span><span class="p">[</span><span class="s1">'ref'</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_ref</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">dataDir</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">),</span> <span class="n">pMd5</span><span class="p">)</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">'vtkClass'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'vtkDataArray'</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">GetName</span><span class="p">()</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">'dataType'</span><span class="p">]</span> <span class="o">=</span> <span class="n">_js_mapping</span><span class="p">[</span><span class="n">arrayTypesMapping</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">GetDataType</span><span class="p">()]]</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">'numberOfComponents'</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">GetNumberOfComponents</span><span class="p">()</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">'size'</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">GetNumberOfComponents</span><span class="p">()</span> <span class="o">*</span> <span class="n">array</span><span class="o">.</span><span class="n">GetNumberOfTuples</span><span class="p">()</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">'ranges'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">root</span><span class="p">[</span><span class="s1">'numberOfComponents'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="s1">'numberOfComponents'</span><span class="p">]):</span>
            <span class="n">root</span><span class="p">[</span><span class="s1">'ranges'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_get_range_info</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">root</span><span class="p">[</span><span class="s1">'ranges'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_get_range_info</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">root</span><span class="p">[</span><span class="s1">'ranges'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_get_range_info</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">root</span>


<span class="k">def</span> <span class="nf">_dump_color_array</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">colorArrayInfo</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">data_loc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'pointData'</span><span class="p">,</span> <span class="s1">'cellData'</span><span class="p">,</span> <span class="s1">'fieldData'</span><span class="p">]:</span>
        <span class="n">root</span><span class="p">[</span><span class="n">data_loc</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'vtkClass'</span><span class="p">:</span> <span class="s1">'vtkDataSetAttributes'</span><span class="p">,</span>
            <span class="s2">"activeGlobalIds"</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"activeNormals"</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"activePedigreeIds"</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"activeScalars"</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"activeTCoords"</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"activeTensors"</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"activeVectors"</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"arrays"</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

    <span class="n">colorArray</span> <span class="o">=</span> <span class="n">colorArrayInfo</span><span class="p">[</span><span class="s1">'colorArray'</span><span class="p">]</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">colorArrayInfo</span><span class="p">[</span><span class="s1">'location'</span><span class="p">]</span>

    <span class="n">dumpedArray</span> <span class="o">=</span> <span class="n">_dump_data_array</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">colorArray</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">dumpedArray</span><span class="p">:</span>
        <span class="n">root</span><span class="p">[</span><span class="n">location</span><span class="p">][</span><span class="s1">'activeScalars'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">root</span><span class="p">[</span><span class="n">location</span><span class="p">][</span><span class="s1">'arrays'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span> <span class="s1">'data'</span><span class="p">:</span> <span class="n">dumpedArray</span> <span class="p">})</span>


<span class="k">def</span> <span class="nf">_dump_tcoords</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
    <span class="n">tcoords</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetTCoords</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">tcoords</span><span class="p">:</span>
        <span class="n">dumpedArray</span> <span class="o">=</span> <span class="n">_dump_data_array</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">tcoords</span><span class="p">)</span>
        <span class="n">root</span><span class="p">[</span><span class="s1">'pointData'</span><span class="p">][</span><span class="s1">'activeTCoords'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="s1">'pointData'</span><span class="p">][</span><span class="s1">'arrays'</span><span class="p">])</span>
        <span class="n">root</span><span class="p">[</span><span class="s1">'pointData'</span><span class="p">][</span><span class="s1">'arrays'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span> <span class="s1">'data'</span><span class="p">:</span> <span class="n">dumpedArray</span> <span class="p">})</span>


<span class="k">def</span> <span class="nf">_dump_normals</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
    <span class="n">normals</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetNormals</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">normals</span><span class="p">:</span>
        <span class="n">dumpedArray</span> <span class="o">=</span> <span class="n">_dump_data_array</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">normals</span><span class="p">)</span>
        <span class="n">root</span><span class="p">[</span><span class="s1">'pointData'</span><span class="p">][</span><span class="s1">'activeNormals'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="s1">'pointData'</span><span class="p">][</span><span class="s1">'arrays'</span><span class="p">])</span>
        <span class="n">root</span><span class="p">[</span><span class="s1">'pointData'</span><span class="p">][</span><span class="s1">'arrays'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span> <span class="s1">'data'</span><span class="p">:</span> <span class="n">dumpedArray</span> <span class="p">})</span>


<span class="k">def</span> <span class="nf">_dump_all_arrays</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">data_loc</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'pointData'</span><span class="p">,</span> <span class="s1">'cellData'</span><span class="p">,</span> <span class="s1">'fieldData'</span><span class="p">]:</span>
        <span class="n">root</span><span class="p">[</span><span class="n">data_loc</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">'vtkClass'</span><span class="p">:</span> <span class="s1">'vtkDataSetAttributes'</span><span class="p">,</span>
            <span class="s2">"activeGlobalIds"</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"activeNormals"</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"activePedigreeIds"</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"activeScalars"</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"activeTCoords"</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"activeTensors"</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"activeVectors"</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s2">"arrays"</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

    <span class="c1"># Point data</span>
    <span class="n">pd</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span>
    <span class="n">pd_size</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">GetNumberOfArrays</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pd_size</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">GetArray</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">array</span><span class="p">:</span>
            <span class="n">dumpedArray</span> <span class="o">=</span> <span class="n">_dump_data_array</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
            <span class="n">root</span><span class="p">[</span><span class="s1">'pointData'</span><span class="p">][</span><span class="s1">'activeScalars'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">root</span><span class="p">[</span><span class="s1">'pointData'</span><span class="p">][</span><span class="s1">'arrays'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span> <span class="s1">'data'</span><span class="p">:</span> <span class="n">dumpedArray</span> <span class="p">})</span>

    <span class="c1"># Cell data</span>
    <span class="n">cd</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetCellData</span><span class="p">()</span>
    <span class="n">cd_size</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">GetNumberOfArrays</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cd_size</span><span class="p">):</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">GetArray</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">array</span><span class="p">:</span>
            <span class="n">dumpedArray</span> <span class="o">=</span> <span class="n">_dump_data_array</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
            <span class="n">root</span><span class="p">[</span><span class="s1">'cellData'</span><span class="p">][</span><span class="s1">'activeScalars'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">root</span><span class="p">[</span><span class="s1">'cellData'</span><span class="p">][</span><span class="s1">'arrays'</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span> <span class="s1">'data'</span><span class="p">:</span> <span class="n">dumpedArray</span> <span class="p">})</span>


<span class="k">def</span> <span class="nf">_dump_poly_data</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">colorArrayInfo</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">'vtkClass'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'vtkPolyData'</span>

    <span class="c1"># Points</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">'points'</span><span class="p">]</span> <span class="o">=</span> <span class="n">_dump_data_array</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetPoints</span><span class="p">()</span><span class="o">.</span><span class="n">GetData</span><span class="p">())</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">'points'</span><span class="p">][</span><span class="s1">'vtkClass'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'vtkPoints'</span>

    <span class="c1"># Cells</span>
    <span class="c1"># # Verts</span>
    <span class="k">for</span> <span class="n">cell_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'verts'</span><span class="p">,</span> <span class="s1">'lines'</span><span class="p">,</span> <span class="s1">'polys'</span><span class="p">,</span> <span class="s1">'strips'</span><span class="p">]:</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="s1">'Get'</span> <span class="o">+</span> <span class="n">cell_type</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())()</span>
        <span class="k">if</span> <span class="n">cell</span> <span class="ow">and</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span><span class="o">.</span><span class="n">GetNumberOfTuples</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">root</span><span class="p">[</span><span class="n">cell_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">_dump_data_array</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">cell</span><span class="o">.</span><span class="n">GetData</span><span class="p">())</span>
            <span class="n">root</span><span class="p">[</span><span class="n">cell_type</span><span class="p">][</span><span class="s1">'vtkClass'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'vtkCellArray'</span>

    <span class="n">_dump_color_array</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">colorArrayInfo</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>

    <span class="c1"># # PointData TCoords</span>
    <span class="n">_dump_tcoords</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>

    <span class="c1"># # PointData Normals</span>
    <span class="n">_dump_normals</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>


<span class="n">_writer_mapping</span><span class="p">[</span><span class="s1">'vtkPolyData'</span><span class="p">]</span> <span class="o">=</span> <span class="n">_dump_poly_data</span>


<span class="k">def</span> <span class="nf">_dump_image_data</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">colorArrayInfo</span><span class="p">,</span> <span class="n">root</span><span class="p">):</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">'vtkClass'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'vtkImageData'</span>

    <span class="n">root</span><span class="p">[</span><span class="s1">'spacing'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetSpacing</span><span class="p">()</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">'origin'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetOrigin</span><span class="p">()</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">'extent'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetExtent</span><span class="p">()</span>

    <span class="n">_dump_all_arrays</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">datasetDir</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>


<span class="n">_writer_mapping</span><span class="p">[</span><span class="s1">'vtkImageData'</span><span class="p">]</span> <span class="o">=</span> <span class="n">_dump_image_data</span>


<span class="k">def</span> <span class="nf">_write_data_set</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">colorArrayInfo</span><span class="p">,</span> <span class="n">newDSName</span><span class="p">):</span>

    <span class="n">dataDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">newDSName</span><span class="p">,</span> <span class="s1">'data'</span><span class="p">)</span>

    <span class="n">root</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">'metadata'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">root</span><span class="p">[</span><span class="s1">'metadata'</span><span class="p">][</span><span class="s1">'name'</span><span class="p">]</span> <span class="o">=</span> <span class="n">newDSName</span>

    <span class="n">writer</span> <span class="o">=</span> <span class="n">_writer_mapping</span><span class="p">[</span><span class="n">dataset</span><span class="o">.</span><span class="n">GetClassName</span><span class="p">()]</span>
    <span class="k">if</span> <span class="n">writer</span><span class="p">:</span>
        <span class="n">writer</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">newDSName</span><span class="p">,</span> <span class="n">dataDir</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">colorArrayInfo</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">'</span><span class="si">{}</span><span class="s1"> is not supported'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">GetClassName</span><span class="p">()))</span>

    <span class="n">scDirs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">newDSName</span><span class="p">,</span> <span class="s1">'index.json'</span><span class="p">),</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)])</span>


<span class="k">def</span> <span class="nf">get_dataset_scalars</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">scalar_mode</span><span class="p">,</span> <span class="n">array_access_mode</span><span class="p">,</span> <span class="n">array_id</span><span class="p">,</span> <span class="n">array_name</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">scalar_mode</span> <span class="o">==</span> <span class="n">SCALAR_MODE</span><span class="o">.</span><span class="n">Default</span><span class="p">:</span>
        <span class="n">scalars</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetScalars</span><span class="p">()</span>
        <span class="n">cell_flag</span> <span class="o">=</span> <span class="s1">'pointData'</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">scalars</span><span class="p">:</span>
            <span class="n">scalars</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetCellData</span><span class="p">()</span><span class="o">.</span><span class="n">GetScalars</span><span class="p">()</span>
            <span class="n">cell_flag</span> <span class="o">=</span> <span class="s1">'cellData'</span>
    <span class="k">elif</span> <span class="n">scalar_mode</span> <span class="o">==</span> <span class="n">SCALAR_MODE</span><span class="o">.</span><span class="n">UsePointData</span><span class="p">:</span>
        <span class="n">scalars</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span><span class="o">.</span><span class="n">GetScalars</span><span class="p">()</span>
        <span class="n">cell_flag</span> <span class="o">=</span> <span class="s1">'pointData'</span>
    <span class="k">elif</span> <span class="n">scalar_mode</span> <span class="o">==</span> <span class="n">SCALAR_MODE</span><span class="o">.</span><span class="n">UseCellData</span><span class="p">:</span>
        <span class="n">scalars</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetCellData</span><span class="p">()</span><span class="o">.</span><span class="n">GetScalars</span><span class="p">()</span>
        <span class="n">cell_flag</span> <span class="o">=</span> <span class="s1">'cellData'</span>
    <span class="k">elif</span> <span class="n">scalar_mode</span> <span class="o">==</span> <span class="n">SCALAR_MODE</span><span class="o">.</span><span class="n">UsePointFieldData</span><span class="p">:</span>
        <span class="n">pd</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetPointData</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">array_access_mode</span> <span class="o">==</span> <span class="n">ACCESS_MODE</span><span class="o">.</span><span class="n">ById</span><span class="p">:</span>
            <span class="n">scalars</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">GetAbstractArray</span><span class="p">(</span><span class="n">array_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scalars</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">GetAbstractArray</span><span class="p">(</span><span class="n">array_name</span><span class="p">)</span>
        <span class="n">cell_flag</span> <span class="o">=</span> <span class="s1">'pointData'</span>
    <span class="k">elif</span> <span class="n">scalar_mode</span> <span class="o">==</span> <span class="n">SCALAR_MODE</span><span class="o">.</span><span class="n">UseCellFieldData</span><span class="p">:</span>
        <span class="n">cd</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetCellData</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">array_access_mode</span> <span class="o">==</span> <span class="n">ACCESS_MODE</span><span class="o">.</span><span class="n">ById</span><span class="p">:</span>
            <span class="n">scalars</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">GetAbstractArray</span><span class="p">(</span><span class="n">array_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scalars</span> <span class="o">=</span> <span class="n">cd</span><span class="o">.</span><span class="n">GetAbstractArray</span><span class="p">(</span><span class="n">array_name</span><span class="p">)</span>
        <span class="n">cell_flag</span> <span class="o">=</span> <span class="s1">'cellData'</span>
    <span class="k">elif</span> <span class="n">scalar_mode</span> <span class="o">==</span> <span class="n">SCALAR_MODE</span><span class="o">.</span><span class="n">UseFieldData</span><span class="p">:</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetFieldData</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">array_access_mode</span> <span class="o">==</span> <span class="n">ACCESS_MODE</span><span class="o">.</span><span class="n">ById</span><span class="p">:</span>
            <span class="n">scalars</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">GetAbstractArray</span><span class="p">(</span><span class="n">array_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scalars</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">GetAbstractArray</span><span class="p">(</span><span class="n">array_name</span><span class="p">)</span>
        <span class="n">cell_flag</span> <span class="o">=</span> <span class="s1">'fieldData'</span>
    <span class="k">return</span> <span class="n">scalars</span><span class="p">,</span> <span class="n">cell_flag</span>


<span class="n">property_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'color'</span><span class="p">,</span> <span class="s1">'ambientColor'</span><span class="p">,</span> <span class="s1">'diffuseColor'</span><span class="p">,</span> <span class="s1">'specularColor'</span><span class="p">,</span> <span class="s1">'edgeColor'</span><span class="p">,</span>
                 <span class="s1">'ambient'</span><span class="p">,</span> <span class="s1">'diffuse'</span><span class="p">,</span> <span class="s1">'specular'</span><span class="p">,</span> <span class="s1">'specularPower'</span><span class="p">,</span> <span class="s1">'opacity'</span><span class="p">,</span>
                 <span class="s1">'interpolation'</span><span class="p">,</span> <span class="s1">'representation'</span><span class="p">,</span> <span class="s1">'edgeVisibility'</span><span class="p">,</span> <span class="s1">'backfaceCulling'</span><span class="p">,</span>
                 <span class="s1">'frontfaceCulling'</span><span class="p">,</span> <span class="s1">'pointSize'</span><span class="p">,</span> <span class="s1">'lineWidth'</span><span class="p">,</span> <span class="s1">'lighting'</span><span class="p">,</span> <span class="s1">'shading'</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">extract_renprop_properties</span><span class="p">(</span><span class="n">renprop</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">renprop</span><span class="p">,</span> <span class="s1">'GetProperty'</span><span class="p">):</span> <span class="c1"># default properties</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span><span class="n">property_name</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">renprop</span><span class="o">.</span><span class="n">GetProperty</span><span class="p">(),</span> <span class="s1">'Get'</span> <span class="o">+</span> <span class="n">property_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">property_name</span><span class="p">[</span><span class="mi">1</span><span class="p">:])()</span>
                      <span class="k">for</span> <span class="n">property_name</span> <span class="ow">in</span> <span class="n">property_list</span><span class="p">}</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">properties</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">properties</span>


<span class="k">def</span> <span class="nf">vtk_lut_to_palette</span><span class="p">(</span><span class="n">lut</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">lut</span><span class="o">.</span><span class="n">GetScale</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">'Only linear Scale lookup tables are implemented'</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="s1">'Linear'</span>
    <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">lut</span><span class="o">.</span><span class="n">GetTableRange</span><span class="p">()</span>
    <span class="n">nb_values</span> <span class="o">=</span> <span class="n">lut</span><span class="o">.</span><span class="n">GetNumberOfTableValues</span><span class="p">()</span>
    <span class="n">rgb_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">lut</span><span class="o">.</span><span class="n">GetTableValue</span><span class="p">(</span><span class="n">val</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_values</span><span class="p">)]</span>
    <span class="n">palette</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"#</span><span class="si">{0:02x}{1:02x}{2:02x}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">r</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">g</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="mi">255</span> <span class="o">*</span> <span class="n">b</span><span class="p">))</span> <span class="k">for</span> <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">rgb_values</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">"palette"</span><span class="p">:</span> <span class="n">palette</span><span class="p">,</span> <span class="s2">"low"</span><span class="p">:</span><span class="n">low</span><span class="p">,</span> <span class="s2">"high"</span><span class="p">:</span><span class="n">high</span><span class="p">,</span> <span class="s2">"scale"</span><span class="p">:</span> <span class="n">scale</span><span class="p">}</span>


<div class="viewcode-block" id="construct_palettes"><a class="viewcode-back" href="../../../../api/panel.pane.vtk.html#panel.pane.vtk.vtkjs_serializer.construct_palettes">[docs]</a><span class="k">def</span> <span class="nf">construct_palettes</span><span class="p">(</span><span class="n">render_window</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    """</span>
    <span class="n">legend</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">render_window</span><span class="o">.</span><span class="n">OffScreenRenderingOn</span><span class="p">()</span> <span class="c1"># to not pop a vtk windows</span>
    <span class="n">render_window</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
    <span class="n">renderers</span> <span class="o">=</span> <span class="n">render_window</span><span class="o">.</span><span class="n">GetRenderers</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">renderer</span> <span class="ow">in</span> <span class="n">renderers</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">renProp</span> <span class="ow">in</span> <span class="n">renderer</span><span class="o">.</span><span class="n">GetViewProps</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetVisibility</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">renProp</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">renProp</span><span class="p">,</span> <span class="s1">'GetMapper'</span><span class="p">):</span>
                <span class="n">mapper</span> <span class="o">=</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetMapper</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">mapper</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">dataObject</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetInputDataObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">dataset</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">dataObject</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">'vtkCompositeDataSet'</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">dataObject</span><span class="o">.</span><span class="n">GetNumberOfBlocks</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataObject</span><span class="o">.</span><span class="n">GetBlock</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">gf</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCompositeDataGeometryFilter</span><span class="p">()</span>
                        <span class="n">gf</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">dataObject</span><span class="p">)</span>
                        <span class="n">gf</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
                        <span class="n">dataset</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">dataObject</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">'vtkUnstructuredGrid'</span><span class="p">):</span>
                    <span class="n">gf</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkGeometryFilter</span><span class="p">()</span>
                    <span class="n">gf</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">dataObject</span><span class="p">)</span>
                    <span class="n">gf</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
                    <span class="n">dataset</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dataset</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetInput</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">dataset</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyData</span><span class="p">)):</span>
                    <span class="c1"># All data must be PolyData surfaces!</span>
                    <span class="n">gf</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkGeometryFilter</span><span class="p">()</span>
                    <span class="n">gf</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
                    <span class="n">gf</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
                    <span class="n">dataset</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">GetOutputDataObject</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">dataset</span> <span class="ow">and</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetPoints</span><span class="p">():</span>
                    <span class="n">scalar_visibility</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetScalarVisibility</span><span class="p">()</span>
                    <span class="n">array_access_mode</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetArrayAccessMode</span><span class="p">()</span>
                    <span class="n">array_name</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetArrayName</span><span class="p">()</span> <span class="c1"># if arrayAccessMode == 1 else mapper.GetArrayId()</span>
                    <span class="n">array_id</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetArrayId</span><span class="p">()</span>
                    <span class="n">scalar_mode</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetScalarMode</span><span class="p">()</span>
                    <span class="n">dataArray</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">lookupTable</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">scalar_visibility</span><span class="p">:</span>
                        <span class="n">dataArray</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">get_dataset_scalars</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">scalar_mode</span><span class="p">,</span> <span class="n">array_access_mode</span><span class="p">,</span> <span class="n">array_id</span><span class="p">,</span> <span class="n">array_name</span><span class="p">)</span>
                        <span class="c1"># component = -1 =&gt; let specific instance get scalar from vector before mapping</span>
                        <span class="k">if</span> <span class="n">dataArray</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dataArray</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">():</span>
                                <span class="n">lookupTable</span> <span class="o">=</span> <span class="n">dataArray</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">array_name</span> <span class="ow">and</span> <span class="n">legend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">legend</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">array_name</span><span class="p">:</span> <span class="n">vtk_lut_to_palette</span><span class="p">(</span><span class="n">lookupTable</span><span class="p">)})</span>
    <span class="k">return</span> <span class="n">legend</span></div>


<div class="viewcode-block" id="render_window_serializer"><a class="viewcode-back" href="../../../../api/panel.pane.vtk.html#panel.pane.vtk.vtkjs_serializer.render_window_serializer">[docs]</a><span class="k">def</span> <span class="nf">render_window_serializer</span><span class="p">(</span><span class="n">render_window</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    Function to convert a vtk render window in a list of 2-tuple where first value</span>
<span class="sd">    correspond to a relative file path in the `vtkjs` directory structure and values</span>
<span class="sd">    of the binary content of the corresponding file.</span>
<span class="sd">    """</span>
    <span class="n">render_window</span><span class="o">.</span><span class="n">OffScreenRenderingOn</span><span class="p">()</span> <span class="c1"># to not pop a vtk windows</span>
    <span class="n">render_window</span><span class="o">.</span><span class="n">Render</span><span class="p">()</span>
    <span class="n">renderers</span> <span class="o">=</span> <span class="n">render_window</span><span class="o">.</span><span class="n">GetRenderers</span><span class="p">()</span>

    <span class="n">objIds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">scDirs</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">sceneComponents</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">textureToSave</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">renderer</span> <span class="ow">in</span> <span class="n">renderers</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">renProp</span> <span class="ow">in</span> <span class="n">renderer</span><span class="o">.</span><span class="n">GetViewProps</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetVisibility</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">renProp</span><span class="p">,</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkActor</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">renProp</span><span class="p">,</span> <span class="s1">'GetMapper'</span><span class="p">):</span>
                <span class="n">mapper</span> <span class="o">=</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetMapper</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">mapper</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">dataObject</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetInputDataObject</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">dataset</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">dataObject</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">'vtkCompositeDataSet'</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">dataObject</span><span class="o">.</span><span class="n">GetNumberOfBlocks</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataObject</span><span class="o">.</span><span class="n">GetBlock</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">gf</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkCompositeDataGeometryFilter</span><span class="p">()</span>
                        <span class="n">gf</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">dataObject</span><span class="p">)</span>
                        <span class="n">gf</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
                        <span class="n">dataset</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">()</span>
                <span class="k">elif</span> <span class="n">dataObject</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">'vtkUnstructuredGrid'</span><span class="p">):</span>
                    <span class="n">gf</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkGeometryFilter</span><span class="p">()</span>
                    <span class="n">gf</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">dataObject</span><span class="p">)</span>
                    <span class="n">gf</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
                    <span class="n">dataset</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">GetOutput</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dataset</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetInput</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">dataset</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="p">(</span><span class="n">vtk</span><span class="o">.</span><span class="n">vtkPolyData</span><span class="p">)):</span>
                    <span class="c1"># All data must be PolyData surfaces!</span>
                    <span class="n">gf</span> <span class="o">=</span> <span class="n">vtk</span><span class="o">.</span><span class="n">vtkGeometryFilter</span><span class="p">()</span>
                    <span class="n">gf</span><span class="o">.</span><span class="n">SetInputData</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
                    <span class="n">gf</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
                    <span class="n">dataset</span> <span class="o">=</span> <span class="n">gf</span><span class="o">.</span><span class="n">GetOutputDataObject</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">dataset</span> <span class="ow">and</span> <span class="n">dataset</span><span class="o">.</span><span class="n">GetPoints</span><span class="p">():</span>
                    <span class="n">componentName</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">renProp</span><span class="p">))</span>
                    <span class="n">scalar_visibility</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetScalarVisibility</span><span class="p">()</span>
                    <span class="n">array_access_mode</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetArrayAccessMode</span><span class="p">()</span>
                    <span class="n">array_name</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetArrayName</span><span class="p">()</span> <span class="c1"># if arrayAccessMode == 1 else mapper.GetArrayId()</span>
                    <span class="n">array_id</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetArrayId</span><span class="p">()</span>
                    <span class="n">color_mode</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetColorMode</span><span class="p">()</span>
                    <span class="n">scalar_mode</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetScalarMode</span><span class="p">()</span>

                    <span class="n">arrayLocation</span> <span class="o">=</span> <span class="s1">''</span>
                    <span class="n">colorArray</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">dataArray</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">colorArrayName</span> <span class="o">=</span> <span class="s1">''</span>
                    <span class="n">lookupTable</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">()</span>

                    <span class="k">if</span> <span class="n">scalar_visibility</span><span class="p">:</span>
                        <span class="n">dataArray</span><span class="p">,</span> <span class="n">arrayLocation</span> <span class="o">=</span> <span class="n">get_dataset_scalars</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">scalar_mode</span><span class="p">,</span> <span class="n">array_access_mode</span><span class="p">,</span> <span class="n">array_id</span><span class="p">,</span> <span class="n">array_name</span><span class="p">)</span>
                        <span class="c1"># component = -1 =&gt; let specific instance get scalar from vector before mapping</span>
                        <span class="k">if</span> <span class="n">dataArray</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dataArray</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">():</span>
                                <span class="n">lookupTable</span> <span class="o">=</span> <span class="n">dataArray</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">()</span>
                                <span class="n">colorArray</span> <span class="o">=</span> <span class="n">dataArray</span><span class="o">.</span><span class="n">GetLookupTable</span><span class="p">()</span><span class="o">.</span><span class="n">MapScalars</span><span class="p">(</span><span class="n">dataArray</span><span class="p">,</span> <span class="n">color_mode</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">colorArray</span> <span class="o">=</span> <span class="n">lookupTable</span><span class="o">.</span><span class="n">MapScalars</span><span class="p">(</span><span class="n">dataArray</span><span class="p">,</span> <span class="n">color_mode</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">colorArrayName</span> <span class="o">=</span> <span class="s1">'__CustomRGBColorArray__'</span>
                            <span class="n">colorArray</span><span class="o">.</span><span class="n">SetName</span><span class="p">(</span><span class="n">colorArrayName</span><span class="p">)</span>
                            <span class="n">color_mode</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="n">colorArrayInfo</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">'colorArray'</span><span class="p">:</span> <span class="n">colorArray</span><span class="p">,</span>
                        <span class="s1">'location'</span><span class="p">:</span> <span class="n">arrayLocation</span>
                    <span class="p">}</span>

                    <span class="n">_write_data_set</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">colorArrayInfo</span><span class="p">,</span> <span class="n">newDSName</span><span class="o">=</span><span class="n">componentName</span><span class="p">)</span>

                    <span class="c1"># Handle texture if any</span>
                    <span class="n">textureName</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetTexture</span><span class="p">()</span> <span class="ow">and</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetTexture</span><span class="p">()</span><span class="o">.</span><span class="n">GetInput</span><span class="p">():</span>
                        <span class="n">textureData</span> <span class="o">=</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetTexture</span><span class="p">()</span><span class="o">.</span><span class="n">GetInput</span><span class="p">()</span>
                        <span class="n">textureName</span> <span class="o">=</span> <span class="s1">'texture_</span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span> <span class="n">_get_object_id</span><span class="p">(</span><span class="n">textureData</span><span class="p">,</span> <span class="n">objIds</span><span class="p">)</span>
                        <span class="n">textureToSave</span><span class="p">[</span><span class="n">textureName</span><span class="p">]</span> <span class="o">=</span> <span class="n">textureData</span>

                    <span class="n">sceneComponents</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">"name"</span><span class="p">:</span> <span class="n">componentName</span><span class="p">,</span>
                        <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"httpDataSetReader"</span><span class="p">,</span>
                        <span class="s2">"httpDataSetReader"</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">"url"</span><span class="p">:</span> <span class="n">componentName</span>
                        <span class="p">},</span>
                        <span class="s2">"actor"</span><span class="p">:</span> <span class="p">{</span>
                            <span class="c1"># customProp</span>
                            <span class="s2">"id"</span><span class="p">:</span> <span class="n">renProp</span><span class="o">.</span><span class="n">__this__</span><span class="p">,</span>
                            <span class="c1"># vtkProp</span>
                            <span class="s2">"visibility"</span><span class="p">:</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetVisibility</span><span class="p">()</span> <span class="k">if</span> <span class="n">renProp</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">'vtkProp'</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s2">"pickable"</span><span class="p">:</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetPickable</span><span class="p">()</span>  <span class="k">if</span> <span class="n">renProp</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">'vtkProp'</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s2">"dragable"</span><span class="p">:</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetDragable</span><span class="p">()</span> <span class="k">if</span> <span class="n">renProp</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">'vtkProp'</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s2">"useBounds"</span><span class="p">:</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetUseBounds</span><span class="p">()</span> <span class="k">if</span> <span class="n">renProp</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">'vtkProp'</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="c1"># vtkProp3D</span>
                            <span class="s2">"origin"</span><span class="p">:</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetOrigin</span><span class="p">()</span> <span class="k">if</span> <span class="n">renProp</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">'vtkProp3D'</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="s2">"scale"</span><span class="p">:</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetScale</span><span class="p">()</span> <span class="k">if</span> <span class="n">renProp</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">'vtkProp3D'</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                            <span class="s2">"position"</span><span class="p">:</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span> <span class="k">if</span> <span class="n">renProp</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">'vtkProp3D'</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                            <span class="c1"># vtkActor</span>
                            <span class="s1">'forceOpaque'</span><span class="p">:</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetForceOpaque</span><span class="p">()</span> <span class="k">if</span> <span class="n">renProp</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">'vtkActor'</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                            <span class="s1">'forceTranslucent'</span><span class="p">:</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetForceTranslucent</span><span class="p">()</span> <span class="k">if</span> <span class="n">renProp</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">'vtkActor'</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="p">},</span>
                        <span class="s2">"actorRotation"</span><span class="p">:</span> <span class="n">renProp</span><span class="o">.</span><span class="n">GetOrientationWXYZ</span><span class="p">()</span> <span class="k">if</span> <span class="n">renProp</span><span class="o">.</span><span class="n">IsA</span><span class="p">(</span><span class="s1">'vtkProp3D'</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="s2">"mapper"</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">"colorByArrayName"</span><span class="p">:</span> <span class="n">colorArrayName</span><span class="p">,</span>
                            <span class="s2">"colorMode"</span><span class="p">:</span> <span class="n">color_mode</span><span class="p">,</span>
                            <span class="s2">"scalarMode"</span><span class="p">:</span> <span class="n">scalar_mode</span>
                        <span class="p">},</span>
                        <span class="s2">"property"</span><span class="p">:</span> <span class="n">extract_renprop_properties</span><span class="p">(</span><span class="n">renProp</span><span class="p">),</span>
                        <span class="s2">"lookupTable"</span><span class="p">:</span> <span class="p">{</span>
                            <span class="s2">"range"</span><span class="p">:</span> <span class="n">lookupTable</span><span class="o">.</span><span class="n">GetRange</span><span class="p">(),</span>
                            <span class="s2">"hueRange"</span><span class="p">:</span> <span class="n">lookupTable</span><span class="o">.</span><span class="n">GetHueRange</span><span class="p">()</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">lookupTable</span><span class="p">,</span> <span class="s1">'GetHueRange'</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">})</span>

                    <span class="k">if</span> <span class="n">textureName</span><span class="p">:</span>
                        <span class="n">sceneComponents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">'texture'</span><span class="p">]</span> <span class="o">=</span> <span class="n">textureName</span>

    <span class="c1"># Save texture data if any</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">textureToSave</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">_write_data_set</span><span class="p">(</span><span class="n">scDirs</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">newDSName</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>

    <span class="n">activeCamera</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">GetActiveCamera</span><span class="p">()</span>
    <span class="n">background</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">GetBackground</span><span class="p">()</span>
    <span class="n">sceneDescription</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"fetchGzip"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">"background"</span><span class="p">:</span> <span class="n">background</span><span class="p">,</span>
        <span class="s2">"camera"</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">"focalPoint"</span><span class="p">:</span> <span class="n">activeCamera</span><span class="o">.</span><span class="n">GetFocalPoint</span><span class="p">(),</span>
            <span class="s2">"position"</span><span class="p">:</span> <span class="n">activeCamera</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">(),</span>
            <span class="s2">"viewUp"</span><span class="p">:</span> <span class="n">activeCamera</span><span class="o">.</span><span class="n">GetViewUp</span><span class="p">(),</span>
            <span class="s2">"clippingRange"</span><span class="p">:</span> <span class="n">activeCamera</span><span class="o">.</span><span class="n">GetClippingRange</span><span class="p">()</span>
        <span class="p">},</span>
        <span class="s2">"centerOfRotation"</span><span class="p">:</span> <span class="n">renderer</span><span class="o">.</span><span class="n">GetCenter</span><span class="p">(),</span>
        <span class="s2">"scene"</span><span class="p">:</span> <span class="n">sceneComponents</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">scDirs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">'index.json'</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">sceneDescription</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)])</span>

    <span class="c1"># create binary stream of the vtkjs directory structure</span>
    <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span>
    <span class="k">with</span> <span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">in_memory</span><span class="p">:</span>
        <span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">in_memory</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">"w"</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dirPath</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">scDirs</span><span class="p">:</span>
                <span class="n">zf</span><span class="o">.</span><span class="n">writestr</span><span class="p">(</span><span class="n">dirPath</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">compress_type</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
                <span class="n">zf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">in_memory</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">in_memory</span><span class="o">.</span><span class="n">read</span><span class="p">()</span></div>

</pre></div>
</div>
</div>
<!-- END MAIN BODY OF DOCS ––––––––––––– -->
<!-- Google Analytics -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-154795830-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-154795830-2');
</script>
<!-- MathJax Config -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>